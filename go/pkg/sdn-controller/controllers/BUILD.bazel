load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")

go_library(
    name = "controllers",
    srcs = [
        "bmh_controller.go",
        "netbox_controller.go",
        "networknode_controller.go",
        "nodegroup_controller.go",
        "portchannel_controller.go",
        "switch_controller.go",
        "switchport_controller.go",
    ],
    importpath = "github.com/intel-innersource/frameworks.cloud.devcloud.services.idc/go/pkg/sdn-controller/controllers",
    visibility = ["//visibility:public"],
    deps = [
        "//go/pkg/baremetal_enrollment/tasks",
        "//go/pkg/k8s/apis/metal3.io/v1alpha1",
        "//go/pkg/k8s/generated/metal3client/clientset/versioned",
        "//go/pkg/k8s/generated/metal3client/informers/externalversions",
        "//go/pkg/k8s/generated/metal3client/listers/metal3.io/v1alpha1",
        "//go/pkg/log",
        "//go/pkg/observability",
        "//go/pkg/sdn-controller/api/v1alpha1",
        "//go/pkg/sdn-controller/pkg/devices_manager",
        "//go/pkg/sdn-controller/pkg/metrics",
        "//go/pkg/sdn-controller/pkg/netbox",
        "//go/pkg/sdn-controller/pkg/pools",
        "//go/pkg/sdn-controller/pkg/status_reporter",
        "//go/pkg/sdn-controller/pkg/switch-clients",
        "//go/pkg/sdn-controller/pkg/utils",
        "@com_github_hashicorp_go_multierror//:go-multierror",
        "@com_github_prometheus_client_golang//prometheus",
        "@io_k8s_api//core/v1:core",
        "@io_k8s_apimachinery//pkg/api/errors",
        "@io_k8s_apimachinery//pkg/apis/meta/v1:meta",
        "@io_k8s_apimachinery//pkg/labels",
        "@io_k8s_apimachinery//pkg/runtime",
        "@io_k8s_apimachinery//pkg/types",
        "@io_k8s_client_go//rest",
        "@io_k8s_client_go//tools/cache",
        "@io_k8s_client_go//tools/record",
        "@io_k8s_client_go//util/workqueue",
        "@io_k8s_sigs_controller_runtime//:controller-runtime",
        "@io_k8s_sigs_controller_runtime//pkg/builder",
        "@io_k8s_sigs_controller_runtime//pkg/client",
        "@io_k8s_sigs_controller_runtime//pkg/controller",
        "@io_k8s_sigs_controller_runtime//pkg/event",
        "@io_k8s_sigs_controller_runtime//pkg/log",
        "@io_k8s_sigs_controller_runtime//pkg/metrics",
        "@io_k8s_sigs_controller_runtime//pkg/predicate",
        "@io_k8s_sigs_controller_runtime//pkg/reconcile",
        "@io_k8s_utils//strings/slices",
        "@io_opentelemetry_go_otel//codes",
        "@org_golang_x_time//rate",
    ],
)

filegroup(
    name = "testdata",
    srcs = glob([
        "bmh-exports-testdata/**",
    ]),
)

go_test(
    name = "controllers_test",
    srcs = [
        "bmh_controller_2_test.go",
        "bmh_controller_test.go",
        "suite_test.go",
    ],
    data = [":testdata"],
    embed = [":controllers"],
    deps = [
        "//go/pkg/k8s/apis/metal3.io/v1alpha1",
        "//go/pkg/sdn-controller/api/v1alpha1",
        "//go/pkg/sdn-controller/tests/mock",
        "@com_github_onsi_ginkgo_v2//:ginkgo",
        "@com_github_onsi_gomega//:gomega",
        "@io_k8s_client_go//rest",
        "@io_k8s_sigs_controller_runtime//pkg/client",
        "@io_k8s_sigs_controller_runtime//pkg/envtest",
        "@io_k8s_sigs_yaml//:yaml",
    ],
)
