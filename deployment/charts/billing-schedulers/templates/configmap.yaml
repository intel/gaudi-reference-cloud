apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "idc-common.fullname" . }}
  namespace: {{ include "idc-common.namespace" . }}  
data:
  config.yaml: |
    listenConfig:
      listenPort: {{ include "idc-common.listenPort" . }}
    database:
      url: {{ include "idc-common.db-url" . }}
      usernameFile: /vault/secrets/db_username
      passwordFile: /vault/secrets/db_password
    creditsInstallSchedulerInterval: {{ .Values.creditsInstallSchedulerInterval }}
    reportUsageSchedulerInterval: {{ .Values.reportUsageSchedulerInterval }}
    reportProductUsageSchedulerInterval: {{ .Values.reportProductUsageSchedulerInterval }}
    creditsExpiryMinimumInterval: {{ .Values.creditsExpiryMinimumInterval }}
    creditUsageSchedulerInterval: {{ .Values.creditUsageSchedulerInterval }}
    creditExpirySchedulerInterval: {{ .Values.creditExpirySchedulerInterval }}
    premiumCloudCreditThreshold: {{ .Values.premiumCloudCreditThreshold }}
    intelCloudCreditThreshold: {{ .Values.intelCloudCreditThreshold }}
    enterpriseCloudCreditThreshold: {{ .Values.enterpriseCloudCreditThreshold }}
    premiumCloudCreditNotifyBeforeExpiry: {{ .Values.premiumCloudCreditNotifyBeforeExpiry }}
    intelCloudCreditNotifyBeforeExpiry: {{ .Values.intelCloudCreditNotifyBeforeExpiry }}
    enterpriseCloudCreditNotifyBeforeExpiry: {{ .Values.enterpriseCloudCreditNotifyBeforeExpiry }}
    servicesTerminationSchedulerInterval: {{ .Values.servicesTerminationSchedulerInterval }}
    servicesTerminationInterval: {{ .Values.servicesTerminationInterval }}
    instanceTerminationMeteringDuration: {{ .Values.instanceTerminationMeteringDuration }}
    eventExpirySchedulerInterval: {{ .Values.eventExpirySchedulerInterval }}
    cloudCreditUsageReportSchedulerInterval: {{ .Values.cloudCreditUsageReportSchedulerInterval }}
    runSchedulers: {{ .Values.runSchedulers }}
    features:
      creditInstallScheduler: {{ .Values.features.creditInstallScheduler }}
      reportUsageScheduler: {{ .Values.features.reportUsageScheduler }}
      reportProductUsageScheduler: {{ .Values.features.reportProductUsageScheduler }}
      creditUsageScheduler: {{ .Values.features.creditUsageScheduler }}
      creditExpiryScheduler: {{ .Values.features.creditExpiryScheduler }}
      servicesTerminationScheduler: {{ .Values.features.servicesTerminationScheduler }}
      eventExpiryScheduler: {{ .Values.features.eventExpiryScheduler }}
      cloudCreditUsageReportScheduler: {{ .Values.features.cloudCreditUsageReportScheduler }}
      servicesTerminationAccountTypes: 
      {{- if $.Values.features.servicesTerminationAccountTypes }}
        {{- range $value := $.Values.features.servicesTerminationAccountTypes }}
          - {{ $value }}
        {{- end }}
      {{- end }}
      creditUsageEmailAccountTypes: 
      {{- if $.Values.features.creditUsageEmailAccountTypes }}
        {{- range $value := $.Values.features.creditUsageEmailAccountTypes }}
          - {{ $value }}
        {{- end }}
      {{- end }}
      creditExpiryEmailAccountTypes: 
      {{- if $.Values.features.creditExpiryEmailAccountTypes }}
        {{- range $value := $.Values.features.creditExpiryEmailAccountTypes }}
          - {{ $value }}
        {{- end }}
      {{- end }}
    notifications:
      senderEmail: {{ .Values.notifications.senderEmail }}
      consoleUrl: {{ .Values.notifications.consoleUrl }}
      paymentUrl: {{ .Values.notifications.paymentUrl }}
      cloudCreditHundredPercentUsedTemplate: {{ .Values.notifications.cloudCreditHundredPercentUsedTemplate }}
      cloudCreditEightyPercentUsedTemplate: {{ .Values.notifications.cloudCreditEightyPercentUsedTemplate }}
      cloudCreditExpiryTemplate: {{ .Values.notifications.cloudCreditExpiryTemplate }}
      pdlEmail: {{ .Values.notifications.pdlEmail }}
