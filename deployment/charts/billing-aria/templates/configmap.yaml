apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "idc-common.fullname" . }}
  namespace: {{ include "idc-common.namespace" . }}  
data:
  config.yaml: |
    listenPort: {{ include "idc-common.listenPort" . }}
    syncInterval: {{ .Values.syncInterval }}
    clientIdPrefix: {{ .Values.clientIdPrefix }}
    clientPlanId: {{ .Values.clientPlanId }}
    usageInterval: {{ .Values.usageInterval }}
    clientAcctGroupId: {{ .Values.clientAcctGroupId }}
    acctPlanActiveInterval: {{ .Values.acctPlanActiveInterval }}
    enterpriseAcctLinkSchedulerInterval: {{ .Values.enterpriseAcctLinkSchedulerInterval }}
    paidServicesDeactivationControllerInterval: {{ .Values.paidServicesDeactivationControllerInterval }}
    instanceSearchWindow: {{ .Values.instanceSearchWindow }}
    premiumDefaultCreditAmount: {{ .Values.premiumDefaultCreditAmount }}
    premiumDefaultCreditExpirationDays: {{ .Values.premiumDefaultCreditExpirationDays }}
    reportUsageSchedulerInterval: {{ .Values.reportUsageSchedulerInterval }}
    reportProductUsageSchedulerInterval: {{ .Values.reportProductUsageSchedulerInterval }}
    authorizationEnabled: {{ .Values.authorizationEnabled }}
    storageInstanceTypes: 
    {{- if $.Values.storageInstanceTypes }}
      {{- range $value := $.Values.storageInstanceTypes }}
        - {{ $value }}
      {{- end }}
    {{- end }}
    database:
      url: {{ include "idc-common.db-url" . }}
      usernameFile: /vault/secrets/db_username
      passwordFile: /vault/secrets/db_password
    ariasystem:
      authKeyFile: {{ .Values.ariasystem.authKeyFile }}
      apiCrtFile: {{ .Values.ariasystem.apiCrtFile }}
      apiKeyFile: {{ .Values.ariasystem.apiKeyFile }}
      insecureSsl: {{ .Values.ariasystem.insecureSsl }}
      clientNoFile: {{ .Values.ariasystem.clientNoFile }}
      coreApiSuffix: {{ .Values.ariasystem.coreApiSuffix }}
      directPostUrl: {{ (.Values.ariasystem).directPostUrl }}
      functionMode: {{ (.Values.ariasystem).functionMode }}
      taxGroup: {{ (.Values.ariasystem).taxGroup }}
      clientTaxGroupId: {{ (.Values.ariasystem).clientTaxGroupId }}
      storageUsageUnitType: {{ .Values.ariasystem.storageUsageUnitType | quote }}
      inferenceUsageUnitType: {{ .Values.ariasystem.inferenceUsageUnitType | quote }}
      tokenUsageUnitType: {{ .Values.ariasystem.tokenUsageUnitType | quote }}
      server:
        coreApiUrl: {{ .Values.ariasystem.server.coreApiUrl | quote }}
        objectApiUrl: {{ .Values.ariasystem.server.objectApiUrl | quote }}
        adminApiUrl: {{ .Values.ariasystem.server.adminApiUrl | quote }}
    aws:
      sqs:
        credentialsFile: {{ .Values.aws.sqs.credentialsFile }}
        region: {{ .Values.aws.sqs.region | quote }}
        accountIdFile: {{ .Values.aws.sqs.accountIdFile }}
        queueUrl: {{ .Values.aws.sqs.queueUrl | quote }}
    billingDriverAria:
      features:
        deactivationScheduler: {{ .Values.billingDriverAria.features.deactivationScheduler }}
        reportUsageScheduler: {{ .Values.billingDriverAria.features.reportUsageScheduler }}
        reportProductUsageScheduler: {{ .Values.billingDriverAria.features.reportProductUsageScheduler }}
        syncStoragePlan: {{ .Values.billingDriverAria.features.syncStoragePlan }}
        syncTokenPlan: {{ .Values.billingDriverAria.features.syncTokenPlan }}
        syncInferencePlan: {{ .Values.billingDriverAria.features.syncInferencePlan }}
      productcatalog:
        storageUsageUnitType: {{ .Values.billingDriverAria.productcatalog.storageUsageUnitType | quote }}
        inferenceUsageUnitType: {{ .Values.billingDriverAria.productcatalog.inferenceUsageUnitType | quote }}
        tokenUsageUnitType: {{ .Values.billingDriverAria.productcatalog.tokenUsageUnitType | quote }}
    
