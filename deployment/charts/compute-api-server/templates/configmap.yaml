apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "idc-common.fullname" . }}
  namespace: {{ include "idc-common.namespace" . }}  
data:
  config.yaml: |
    listenPort: {{ include "idc-common.listenPort" . }}
    database:
      url: {{ include "idc-common.db-url" . }}
      usernameFile: /vault/secrets/db_username
      passwordFile: /vault/secrets/db_password
    region: {{ .Values.region }}
    vmInstanceSchedulerAddr: {{ .Values.vmInstanceSchedulerAddr | quote }}
    billingServerAddr: {{ .Values.billingServerAddr | quote }}
    cloudaccountServerAddr: {{ .Values.cloudaccountServerAddr | quote }}
    nameservers:
    {{- range .Values.nameservers }}
    - {{ . | quote }}
    {{- end }}
    vNetService:
      subnetConsumerIdPattern: {{ .Values.vNetService.subnetConsumerIdPattern | quote }}
    purgeInstanceInterval: {{ .Values.purgeInstanceInterval | quote }}
    getDeactivateInstancesInterval: {{ .Values.getDeactivateInstancesInterval | quote }}
    purgeInstanceAge: {{ .Values.purgeInstanceAge | quote }}
    domainSuffix: {{ .Values.domainSuffix | quote }}
    dbMaxIdleConnectionCount: {{ .Values.dbMaxIdleConnectionCount | quote }}
    cloudAccountQuota: {{ .Values.cloudAccountQuota | toJson }}
    objectStoragePrivateServerAddr: {{ .Values.objectStoragePrivateServerAddr | quote }}
    quotaManagementServerAddr: {{ .Values.quotaManagementServerAddr | quote }}
    featureFlags:
      {{- toYaml .Values.featureFlags | nindent 8 }}
    fleetAdminServerAddr: {{ .Values.fleetAdminServerAddr | quote }}
    acceleratorInterface:
      {{- toYaml .Values.acceleratorInterface | nindent 8 }}
    storageInterface:
      {{- toYaml .Values.storageInterface | nindent 8 }}
