# INTEL CONFIDENTIAL
# Copyright (C) 2023 Intel Corporation
load("@aspect_bazel_lib//lib:write_source_files.bzl", "write_source_files")
load("@io_bazel_rules_go//go:def.bzl", "go_library")

package(default_visibility = ["//visibility:public"])

# gazelle:exclude client.gen.go
# gazelle:ignore

go_library(
    name = "client",
    srcs = [
        ":client_gen",
    ],
    importpath = "github.com/intel-innersource/applications.infrastructure.idcstorage.sds-controller/services/storage_controller/pkg/backend/vast/client",
    visibility = ["//visibility:public"],
    deps = [
        "@com_github_getkin_kin_openapi//openapi3:go_default_library",
        "@com_github_oapi_codegen_runtime//:go_default_library",
        "@com_github_oapi_codegen_runtime//types:go_default_library",
    ],
)

genrule(
    name = "client_gen",
    srcs = [
        "config.yaml",
        "//bazel/third_party/vast:openapi3.json",
    ],
    outs = ["api.go"],
    cmd = "$(location @com_github_deepmap_oapi_codegen_v2//cmd/oapi-codegen) --config=$(location config.yaml) -o=$(location api.go) $(location //bazel/third_party/vast:openapi3.json)",
    tools = [
        "@com_github_deepmap_oapi_codegen_v2//cmd/oapi-codegen",
    ],
)

write_source_files(
    name = "write_gen",
    files = {
        "client.gen.go": ":client_gen",
    },
)
